buildscript 
{
	repositories 
	{
		mavenLocal()
	    mavenCentral()
	    jcenter()
        maven { url "https://oss.sonatype.org/content/repositories/snapshots" }
	    
	}

  	dependencies {
    	classpath "io.spring.gradle:dependency-management-plugin:1.0.6.RELEASE"
        classpath("org.springframework.boot:spring-boot-gradle-plugin:1.5.7.RELEASE")
        classpath 'de.undercouch:gradle-download-task:4.0.3'
  	}
  	
  	dependencies {
        classpath "net.saliman:gradle-cobertura-plugin:3.0.0"
    }
}

plugins 
{
//  id 'net.saliman.cobertura' version '2.5.4'
  id 'net.saliman.cobertura' version '3.0.0'
  id "io.spring.dependency-management" version "1.0.6.RELEASE"
  id 'com.palantir.docker' version "0.21.0"
  id "de.undercouch.download" version "3.4.3"
}


apply plugin: "io.spring.dependency-management"
apply plugin: 'org.springframework.boot'
apply plugin: 'java'
apply plugin: 'war'
apply plugin: 'eclipse'
apply plugin: "net.saliman.cobertura"

sourceCompatibility = 1.8
targetCompatibility = 1.8

repositories 
{
	mavenLocal()
    mavenCentral()
    maven {
        url 'https://repo.spring.io/libs-release'
    }
}

task downloadZipFile(type: Download) {
    src 'https://codeload.github.com/nickperkinslondon/angular-bootstrap-nav-tree/zip/master'
    dest new File(buildDir, 'downloads/master.zip')
	onlyIfModified true
}

task downloadAndUnzipFile(dependsOn: downloadZipFile, type: Copy) {
    from zipTree(downloadZipFile.dest)
    into new File(buildDir, 'downloads')
}

war 
{
		
    from( "${buildDir}/downloads/angular-bootstrap-nav-tree-master/dist" ) {
    	include('abn_tree.css')
    	into('css') }

    from( "${buildDir}/downloads/angular-bootstrap-nav-tree-master/dist" ) {
    	include('abn_tree_directive.js')
    	into('js') }
    	
    dependsOn downloadAndUnzipFile
	baseName = 'Abbot3'
}

docker
{
	name 'tombi/abbot'
	dockerfile file('src/main/docker/abbot/Dockerfile')
	dependsOn tasks.war, tasks.bootRepackage
	files tasks.war.outputs, 'Abbot3.war'
}

cobertura
{
    coverageExcludes = ["com.runcible.controllers.*"];
}

dependencyManagement 
{
  imports 
  {
    mavenBom 'org.springframework.data:spring-data-releasetrain:Ingalls-SR14'
  }
}

dependencies 
{
//    classpath "net.saliman:gradle-cobertura-plugin:3.0.0"
    
	compile 'org.springframework:spring-context:4.3.11.RELEASE'
	compile 'org.springframework:spring-core:4.3.11.RELEASE'
	compile 'org.springframework:spring-webmvc:4.3.11.RELEASE'
	
    compile 'org.springframework.security:spring-security-core:4.2.3.RELEASE'
    compile 'org.springframework.security:spring-security-web:4.2.3.RELEASE'
    compile 'org.springframework.security:spring-security-config:4.2.3.RELEASE'
    compile 'org.springframework.boot:spring-boot-starter-data-jpa'
    
	compile 'org.springframework.data:spring-data-jpa:1.11.7.RELEASE'
	
	compile 'javax.validation:validation-api:2.0.0.Final'
	
	compile 'org.hibernate:hibernate-validator:6.0.2.Final'
	
	compile group: 'com.fasterxml.jackson.datatype', name: 'jackson-datatype-jsr310', version: '2.3.0-rc1'
	
	compile group: 'javax.servlet', name: 'javax.servlet-api', version: '3.1.0'
	
	compile 'commons-dbcp:commons-dbcp'
	
	runtime 'com.fasterxml.jackson.core:jackson-core'
	runtime 'com.fasterxml.jackson.core:jackson-databind'
	//runtime 'javax.servlet:jstl'

	runtime group: 'org.hsqldb', name: 'hsqldb', version: '2.4.0'
	runtime group: 'mysql', name: 'mysql-connector-java', version: '5.1.45'
	runtime group: 'org.webjars', name: 'bootstrap', version: '3.3.7'
	runtime group: 'org.webjars', name: 'jquery', version: '3.3.1-2'
	runtime group: 'org.webjars', name: 'jquery-validation', version: '1.13.0-1'
	runtime group: 'org.webjars.bower', name: 'angular', version: '1.7.5'
	runtime group: 'org.webjars.bower', name: 'angular-animate', version: '1.7.5'
	runtime group: 'org.webjars.bower', name: 'angular-touch', version: '1.7.5'
	runtime group: 'org.webjars.bower', name: 'angular-route', version: '1.7.5'
	
	compile group: 'log4j', name: 'log4j', version: '1.2.17'
	compile group: 'com.zaxxer', name: 'HikariCP', version: '3.0.0'
	
	testCompile 'org.mockito:mockito-all:1.10.19'
	testCompile 'junit:junit:4.12+'
	testCompile 'org.springframework:spring-test:4.3.11.RELEASE'
	testCompile 'org.springframework:spring-web:4.3.11.RELEASE'
	testCompile 'com.fasterxml.jackson.core:jackson-annotations'
	testCompile 'com.fasterxml.jackson.core:jackson-databind'
	testCompile 'com.jayway.jsonpath:json-path:2.4.0'
	testCompile 'org.hamcrest:hamcrest-all:1.3'
	testCompile 'org.glassfish:javax.el:3.0.0'
	testCompile 'org.springframework.boot:spring-boot-test-autoconfigure:1.5.8.RELEASE'
	
	testRuntime 'junit:junit:4.12+'
	testRuntime 'javax.servlet:javax.servlet-api:3.1.0'
	testRuntime 'commons-fileupload:commons-fileupload:1.3.1'
	testRuntime 'javax.el:el-api:2.2'
	testRuntime "org.slf4j:slf4j-api:1.7.10"
}


test.finalizedBy(project.tasks.coberturaReport)


